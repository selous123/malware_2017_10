import os
import math
import numpy as np
from PIL import Image

ROOT_PATH = "/home/lili/Tao_Zhang/dataset/Opcode-2017-0707"
DES_ROOT_PATH = "/home/lili/Tao_Zhang/dataset/opcode"
directory_name = ["malicious/","normal/"]#test/1,train/1

size = 512
des_path = "/home/lrh"

def read_single_file(path,des_path):
    f = open(path)
    result = []
    for line in f:
        l = list(line)
        del l[-2:]
        l = [ord(i) for i in l]
        #print l
        result.extend(l)
    width = int(math.floor(math.sqrt(len(result))))
    #print width
    img = Image.fromarray(np.resize(np.uint8(np.array(result)),(width,width)))
    #resize
    img = img.resize((size,size),Image.ANTIALIAS)
    img.save(des_path)
    
    
    
    
if __name__=="__main__":
    direcs = ["malicious/test/1","malicious/train/1","normal/test/1","normal/train/1"]
    des_direcs  = ["test/malware","train/malware","test/normal","train/normal"]
    directorys = [os.path.join(ROOT_PATH,direc) for direc in direcs]
    for i,directory in enumerate(directorys):
        for path in os.listdir(directory):
            des_path = os.path.join(DES_ROOT_PATH,des_direcs[i],path.split(".")[1]+".jpg")
            read_single_file(os.path.join(directory,path),des_path)